# GitHub Pull Request Metrics Tool

Generated By: Cursor (Claude Sonnet 4.5)

A command-line tool to generate CSV reports containing key metrics for all pull requests in a GitHub repository within a specified time range.

## What It Does

Analyzes GitHub pull requests and generates CSV reports with metrics including:
- PR creation, ready-for-review, merged, and closed timestamps
- Comment counts (total and bot-specific)
- Change request counts (total and unique reviewers)
- Approval counts and PR status

## Installation

```bash
make install
```

This installs the `gh-pr-metrics` command to `~/.local/bin` (ensure it's in your PATH).

## Usage

```bash
# Show help
gh-pr-metrics --help

# Basic usage (auto-detects current repo, analyzes last 365 days)
gh-pr-metrics

# Public repository example (no token required)
gh-pr-metrics --owner ansible --repo awx --start 2025-11-01 --end 2025-11-05 --output /tmp/awx-metrics.csv

# Custom AI bot pattern (match multiple AI bots)
gh-pr-metrics --ai-bot-regex "cursor\\[bot\\]|copilot\\[bot\\]"

# Disable AI bot detection (treat all bots as non-AI)
gh-pr-metrics --ai-bot-regex ""
```

### Authentication

Set `GITHUB_TOKEN` environment variable for private repositories or to avoid rate limits:

**Note:** Without a token, the tool automatically uses `--workers=1` to reduce API load for unauthenticated rate limit (60 requests/hour).

## CSV Output

Example output:

```csv
pr_number,title,author,created_at,ready_for_review_at,merged_at,closed_at,total_comment_count,non_ai_bot_comment_count,ai_bot_comment_count,non_ai_bot_login_names,ai_bot_login_names,changes_requested_count,unique_change_requesters,approval_count,status,url,errors
123,"Fix bug",user1,2024-01-15T10:30:00Z,2024-01-15T14:20:00Z,2024-01-16T09:00:00Z,2024-01-16T09:00:00Z,15,2,1,"dependabot[bot],github-actions[bot]",cursor[bot],2,2,3,merged,https://github.com/owner/repo/pull/123,
124,"Add feature",user2,2024-01-16T09:15:00Z,,,,8,1,0,sonarqubecloud[bot],,0,0,1,open,https://github.com/owner/repo/pull/124,
```

### Column Descriptions

- `pr_number` - Pull request number
- `title` - Pull request title
- `author` - Pull request author username
- `created_at` - ISO 8601 timestamp when PR was created
- `ready_for_review_at` - ISO 8601 timestamp when PR was marked ready (empty for draft PRs)
- `merged_at` - ISO 8601 timestamp when PR was merged (empty if not merged)
- `closed_at` - ISO 8601 timestamp when PR was closed (empty if still open)
- `total_comment_count` - Total comments (includes all bot and human comments)
- `non_ai_bot_comment_count` - Non-AI bot comments only (excludes AI bots and humans)
- `ai_bot_comment_count` - AI bot comments only (currently tracks cursor[bot])
- `non_ai_bot_login_names` - Comma-separated list of non-AI bot logins that commented
- `ai_bot_login_names` - Comma-separated list of AI bot logins that commented
- `changes_requested_count` - Total change requests submitted
- `unique_change_requesters` - Unique reviewers who requested changes
- `approval_count` - Current approval count (latest state per reviewer)
- `status` - One of: draft, open, closed, merged
- `url` - Full URL to the pull request
- `errors` - Error messages if data collection failed (usually empty)

## Contributing

Development workflow:

```bash
# Install development dependencies
make requirements-dev

# Code quality checks
make format    # Auto-format code with black
make lint      # Check code with ruff
make test      # Run unit tests
make coverage  # Verify 70%+ test coverage
```

### Contribution Guidelines

1. Follow PEP 8 style (enforced by `ruff`)
2. Add tests for new features
3. Ensure `make format lint test coverage` passes
4. Include `Assisted-by: <Tool> (<Model>)` in commit messages
5. Add `Generated By: <Tool> (<Model>)` to new file headers

### Requirements

- Python 3.10+
- GitHub.com repositories (GitHub Enterprise not supported)

