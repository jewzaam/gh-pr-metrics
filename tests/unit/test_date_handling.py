# Generated By: Cursor (Claude Sonnet 4.5)
"""Tests for date and timestamp handling."""

import pytest

import gh_pr_metrics


class TestDateParsing:
    """Test date and timestamp parsing."""

    def test_parse_iso8601_timestamp(self):
        """Test parsing ISO 8601 timestamp."""
        result = gh_pr_metrics.parse_timestamp("2024-01-01T00:00:00Z")
        assert result.year == 2024
        assert result.month == 1
        assert result.day == 1

    def test_parse_unix_timestamp(self):
        """Test parsing Unix timestamp."""
        result = gh_pr_metrics.parse_timestamp("1704067200")  # 2024-01-01 00:00:00 UTC
        # Just verify we can parse it - actual time depends on local timezone
        assert result.month in [1, 12]  # Could be Dec 31 or Jan 1 depending on timezone

    def test_parse_rfc3339_timestamp(self):
        """Test parsing RFC 3339 timestamp."""
        result = gh_pr_metrics.parse_timestamp("2024-06-15T12:30:45+00:00")
        assert result.year == 2024
        assert result.month == 6
        assert result.day == 15

    def test_parse_invalid_timestamp_raises_error(self):
        """Test that invalid timestamp raises an error."""
        with pytest.raises(Exception):
            gh_pr_metrics.parse_timestamp("invalid")

    def test_parse_timestamp_returns_timezone_aware(self):
        """Test that parse_timestamp always returns timezone-aware datetimes."""
        # ISO 8601 with timezone
        result1 = gh_pr_metrics.parse_timestamp("2024-01-01T00:00:00Z")
        assert result1.tzinfo is not None

        # ISO 8601 without timezone (should add UTC)
        result2 = gh_pr_metrics.parse_timestamp("2024-01-01T00:00:00")
        assert result2.tzinfo is not None

        # Unix timestamp (should add UTC)
        result3 = gh_pr_metrics.parse_timestamp("1704067200")
        assert result3.tzinfo is not None

    def test_parse_timestamp_comparison_with_datetime_now_utc(self):
        """Test that parsed timestamps can be compared with datetime.now(timezone.utc)."""
        from datetime import datetime, timezone

        # Parse a timestamp from the past
        past_date = gh_pr_metrics.parse_timestamp("2024-01-01T00:00:00Z")
        now = datetime.now(timezone.utc)

        # This should not raise "can't compare offset-naive and offset-aware datetimes"
        assert past_date < now
