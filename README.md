# GitHub Pull Request Metrics Tool

Generated By: Cursor (Claude Sonnet 4.5)

A command-line tool to generate CSV reports containing key metrics for all pull requests in a GitHub repository within a specified time range.

## What It Does

Analyzes GitHub pull requests and generates CSV reports with metrics including:
- PR creation, ready-for-review, merged, and closed timestamps
- Comment counts (total and bot-specific)
- Change request counts (total and unique reviewers)
- Approval counts and PR status

## Installation

```bash
make install
```

This installs the `gh-pr-metrics` command to `~/.local/bin` (ensure it's in your PATH).

## Usage

```bash
# Show help
gh-pr-metrics --help

# Basic usage (auto-detects current repo, analyzes last 365 days)
gh-pr-metrics

# Public repository example (no token required)
gh-pr-metrics --owner ansible --repo awx --start 2025-11-01 --end 2025-11-05 --output /tmp/awx-metrics.csv
```

### Authentication

Set `GITHUB_TOKEN` environment variable for private repositories or to avoid rate limits:

**Note:** Without a token, the tool automatically uses `--workers=1` to reduce API load for unauthenticated rate limit (60 requests/hour).

## CSV Output

Example output:

```csv
pr_number,created_at,ready_for_review_at,merged_at,closed_at,comments_total,comments_bot,change_requests_total,change_requests_unique,approvals,status,errors
123,2024-01-15T10:30:00Z,2024-01-15T14:20:00Z,2024-01-16T09:00:00Z,2024-01-16T09:00:00Z,15,3,2,2,3,merged,
124,2024-01-16T09:15:00Z,,,,8,1,0,0,1,open,
125,2024-01-17T11:00:00Z,2024-01-18T08:30:00Z,,2024-01-19T12:00:00Z,22,5,4,3,2,closed,
```

### Column Descriptions

- `pr_number` - Pull request number
- `created_at` - ISO 8601 timestamp when PR was created
- `ready_for_review_at` - ISO 8601 timestamp when PR was marked ready (empty for draft PRs)
- `merged_at` - ISO 8601 timestamp when PR was merged (empty if not merged)
- `closed_at` - ISO 8601 timestamp when PR was closed (empty if still open)
- `comments_total` - Total comments (includes bot comments)
- `comments_bot` - Bot comments only
- `change_requests_total` - Total change requests submitted
- `change_requests_unique` - Unique reviewers who requested changes
- `approvals` - Current approval count (latest state per reviewer)
- `status` - One of: draft, open, closed, merged
- `errors` - Error messages if data collection failed (usually empty)

## Contributing

Development workflow:

```bash
# Install development dependencies
make requirements-dev

# Code quality checks
make format    # Auto-format code with black
make lint      # Check code with ruff
make test      # Run unit tests
make coverage  # Verify 70%+ test coverage
```

### Contribution Guidelines

1. Follow PEP 8 style (enforced by `ruff`)
2. Add tests for new features
3. Ensure `make format lint test coverage` passes
4. Include `Assisted-by: <Tool> (<Model>)` in commit messages
5. Add `Generated By: <Tool> (<Model>)` to new file headers

### Requirements

- Python 3.10+
- GitHub.com repositories (GitHub Enterprise not supported)

