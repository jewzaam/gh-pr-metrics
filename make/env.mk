# Generated By: Cursor (Claude Sonnet 4.5)
# Environment Setup Targets
# ==========================

.PHONY: venv uv requirements requirements-dev requirements-txt requirements-dev-txt setup-dev install-package clean

venv: ## Create Python virtual environment
	@if [ ! -d "$(VENV_DIR)" ]; then \
		$(PYTHON) -m venv $(VENV_DIR); \
		printf "$(GREEN)✅ Virtual environment created$(RESET)\n"; \
	fi
	@if [ ! -f "$(VENV_DIR)/bin/pip" ]; then \
		$(VENV_PYTHON) -m ensurepip --upgrade; \
		printf "$(GREEN)✅ pip installed$(RESET)\n"; \
	fi

uv: venv ## Install uv package manager
	@if [ ! -f "$(VENV_DIR)/bin/uv" ]; then \
		$(VENV_PIP) install uv; \
		printf "$(GREEN)✅ uv installed$(RESET)\n"; \
	fi

requirements: venv uv ## Install runtime dependencies (from pyproject.toml)
	@$(VENV_UV) pip install --upgrade pip >/dev/null
	@$(VENV_UV) pip install -e .
	@echo "✅ Runtime dependencies installed in $(VENV_DIR)"

requirements-dev: venv uv ## Install all dev dependencies (from pyproject.toml)
	@$(VENV_UV) pip install -e ".[dev]"
	@echo "✅ All dev dependencies installed in $(VENV_DIR)"

requirements-txt: venv uv ## Install runtime dependencies from requirements.txt
	@$(VENV_UV) pip install -r requirements.txt
	@echo "✅ Runtime dependencies from requirements.txt installed in $(VENV_DIR)"

requirements-dev-txt: venv uv ## Install dev dependencies from requirements-dev.txt
	@$(VENV_UV) pip install -r requirements-dev.txt
	@echo "✅ Dev dependencies from requirements-dev.txt installed in $(VENV_DIR)"

setup-dev: requirements-dev-txt ## Install dev deps from requirements-dev.txt + package in editable mode
	@$(VENV_UV) pip install -e .
	@echo "✅ Full dev environment ready (requirements-dev.txt + editable package)"

install-package: requirements-dev ## Install package in editable mode (needed for tests)
	@$(VENV_UV) pip install -e .
	@echo "✅ Package installed in editable mode in $(VENV_DIR)"

install: ## Install package to user environment (~/.local)
	@pip install --user -e .
	@echo "✅ Package installed in editable mode to user environment"
	@echo "   If 'gh-pr-metrics' command is not found, ensure ~/.local/bin is in your PATH"

clean: ## Remove temporary and backup files
	# Python caches
	@find . -name "*.pyc" -delete 2>/dev/null || true
	@find . -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true
	# Test artifacts
	@rm -rf .pytest_cache .coverage htmlcov .tox .coverage-percentage .mypy_cache .ruff_cache 2>/dev/null || true
	# Build artifacts
	@rm -rf dist build *.egg-info/ src/*.egg-info/ 2>/dev/null || true
	# Python virtual environment (main one only)
	@rm -rf $(VENV_DIR) 2>/dev/null || true
	# Misc artifacts
	@rm -rf local scratch logs coverage.xml 2>/dev/null || true
	@echo "✅ Cleanup completed"

